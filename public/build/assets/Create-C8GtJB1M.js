import{r as n,j as e,v as _,R as B}from"./app-efWKSDAH.js";import{A as D}from"./AuthenticatedLayout-ClPL5Bra.js";import{M as T,i as z,u as $,P as F,a as I,b as W,L as H,m as L}from"./proxy-DVawERsm.js";import"./ApplicationLogo-DcFCchUW.js";import"./transition-CLJUmDzh.js";class K extends n.Component{getSnapshotBeforeUpdate(d){const s=this.props.childRef.current;if(s&&d.isPresent&&!this.props.isPresent){const a=s.offsetParent,m=z(a)&&a.offsetWidth||0,i=this.props.sizeRef.current;i.height=s.offsetHeight||0,i.width=s.offsetWidth||0,i.top=s.offsetTop,i.left=s.offsetLeft,i.right=m-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function U({children:r,isPresent:d,anchorX:s}){const a=n.useId(),m=n.useRef(null),i=n.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:f}=n.useContext(T);return n.useInsertionEffect(()=>{const{width:p,height:l,top:g,left:o,right:c}=i.current;if(d||!m.current||!p||!l)return;const h=s==="left"?`left: ${o}`:`right: ${c}`;m.current.dataset.motionPopId=a;const t=document.createElement("style");return f&&(t.nonce=f),document.head.appendChild(t),t.sheet&&t.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${l}px !important;
            ${h}px !important;
            top: ${g}px !important;
          }
        `),()=>{document.head.contains(t)&&document.head.removeChild(t)}},[d]),e.jsx(K,{isPresent:d,childRef:m,sizeRef:i,children:n.cloneElement(r,{ref:m})})}const V=({children:r,initial:d,isPresent:s,onExitComplete:a,custom:m,presenceAffectsLayout:i,mode:f,anchorX:p})=>{const l=$(G),g=n.useId();let o=!0,c=n.useMemo(()=>(o=!1,{id:g,initial:d,isPresent:s,custom:m,onExitComplete:h=>{l.set(h,!0);for(const t of l.values())if(!t)return;a&&a()},register:h=>(l.set(h,!1),()=>l.delete(h))}),[s,l,a]);return i&&o&&(c={...c}),n.useMemo(()=>{l.forEach((h,t)=>l.set(t,!1))},[s]),n.useEffect(()=>{!s&&!l.size&&a&&a()},[s]),f==="popLayout"&&(r=e.jsx(U,{isPresent:s,anchorX:p,children:r})),e.jsx(F.Provider,{value:c,children:r})};function G(){return new Map}const S=r=>r.key||"";function M(r){const d=[];return n.Children.forEach(r,s=>{n.isValidElement(s)&&d.push(s)}),d}const O=({children:r,custom:d,initial:s=!0,onExitComplete:a,presenceAffectsLayout:m=!0,mode:i="sync",propagate:f=!1,anchorX:p="left"})=>{const[l,g]=I(f),o=n.useMemo(()=>M(r),[r]),c=f&&!l?[]:o.map(S),h=n.useRef(!0),t=n.useRef(o),u=$(()=>new Map),[j,y]=n.useState(o),[v,P]=n.useState(o);W(()=>{h.current=!1,t.current=o;for(let b=0;b<v.length;b++){const x=S(v[b]);c.includes(x)?u.delete(x):u.get(x)!==!0&&u.set(x,!1)}},[v,c.length,c.join("-")]);const C=[];if(o!==j){let b=[...o];for(let x=0;x<v.length;x++){const N=v[x],k=S(N);c.includes(k)||(b.splice(x,0,N),C.push(N))}return i==="wait"&&C.length&&(b=C),P(M(b)),y(o),null}const{forceRender:w}=n.useContext(H);return e.jsx(e.Fragment,{children:v.map(b=>{const x=S(b),N=f&&!l?!1:o===v||c.includes(x),k=()=>{if(u.has(x))u.set(x,!0);else return;let E=!0;u.forEach(A=>{A||(E=!1)}),E&&(w==null||w(),P(t.current),f&&(g==null||g()),a&&a())};return e.jsx(V,{isPresent:N,initial:!h.current||s?void 0:!1,custom:d,presenceAffectsLayout:m,mode:i,onExitComplete:N?void 0:k,anchorX:p,children:b},x)})})},X=({showtime:r,onSeatsSelected:d})=>{const[s,a]=n.useState([]),[m,i]=n.useState([]),[f,p]=n.useState(!0),[l,g]=n.useState(null),{get:o}=_({showtime_id:r.id});n.useEffect(()=>{c()},[r.id]);const c=()=>{p(!0),o(route("seats.availability",{hall:r.hall_id}),{onSuccess:t=>{i(t.seats),p(!1)},onError:t=>{g("Failed to load seats. Please try again."),p(!1)}})},h=t=>{t.status!=="booked"&&a(u=>u.find(y=>y.id===t.id)?u.filter(y=>y.id!==t.id):[...u,t])};return n.useEffect(()=>{d(s)},[s]),f?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):l?e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-red-600",children:l}),e.jsx("button",{onClick:c,className:"mt-2 text-sm text-red-600 hover:text-red-800",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg text-center",children:e.jsx("h3",{className:"text-lg font-medium",children:"Screen"})}),e.jsx("div",{className:"grid grid-cols-8 gap-2",children:m.map(t=>e.jsx(L.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>h(t),className:`
                            p-2 rounded-lg text-center text-sm
                            ${t.status==="booked"?"bg-gray-300 cursor-not-allowed":s.find(u=>u.id===t.id)?"bg-primary text-white":"bg-gray-200 hover:bg-gray-300"}
                        `,disabled:t.status==="booked",children:t.seat_number},t.id))}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded mr-2"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-primary rounded mr-2"}),e.jsx("span",{children:"Selected"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 rounded mr-2"}),e.jsx("span",{children:"Booked"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["Selected: ",s.length," seats"]}),e.jsxs("p",{className:"text-gray-600",children:["Total: $",(s.length*r.price).toFixed(2)]})]})]})]})},R=[{id:"seats",title:"Select Seats"},{id:"payment",title:"Payment Details"},{id:"confirmation",title:"Confirmation"}],ee=({auth:r,showtime:d,movie:s})=>{const[a,m]=n.useState("seats"),[i,f]=n.useState([]),{data:p,setData:l,post:g,processing:o,errors:c}=_({showtime_id:d.id,seat_ids:[],payment_method:""}),h=j=>{f(j),l("seat_ids",j.map(y=>y.id))},t=j=>{j.preventDefault(),g(route("bookings.store"),{onSuccess:()=>{m("confirmation")}})},u=()=>{switch(a){case"seats":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Select Your Seats"}),e.jsx(X,{showtime:d,onSeatsSelected:h})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>m("payment"),disabled:i.length===0,className:"btn-primary",children:"Continue to Payment"})})]});case"payment":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Payment Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("select",{value:p.payment_method,onChange:j=>l("payment_method",j.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"card",children:"Credit Card"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"online",children:"Online Payment"})]}),c.payment_method&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.payment_method})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Booking Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Movie: ",s.title]}),e.jsxs("p",{children:["Showtime: ",d.start_time]}),e.jsxs("p",{children:["Seats: ",i.length]}),e.jsxs("p",{className:"font-bold",children:["Total: $",(i.length*d.price).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>m("seats"),className:"btn-secondary",children:"Back"}),e.jsx("button",{onClick:t,disabled:o||!p.payment_method,className:"btn-primary",children:o?"Processing...":"Complete Booking"})]})]});case"confirmation":return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Thank you for your booking. A confirmation email has been sent to your email address."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("a",{href:route("bookings.index"),className:"btn-primary block",children:"View My Bookings"}),e.jsx("a",{href:route("dashboard"),className:"btn-secondary block",children:"Return to Dashboard"})]})]});default:return null}};return e.jsx(D,{user:r.user,children:e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:R.map((j,y)=>e.jsxs(B.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                                                w-8 h-8 rounded-full flex items-center justify-center
                                                ${a===j.id?"bg-primary text-white":"bg-gray-200"}
                                            `,children:y+1}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:j.title})]}),y<R.length-1&&e.jsx("div",{className:"flex-1 h-0.5 bg-gray-200 mx-4"})]},j.id))})}),e.jsx(O,{mode:"wait",children:e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},children:u()},a)})]})})})};export{ee as default};
